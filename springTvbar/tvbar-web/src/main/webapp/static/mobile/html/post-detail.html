<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta content="telephone=no" name="format-detection"/>
    <meta content="email=no" name="format-detection"/>
    <link rel="stylesheet" href="http://re.tvbar.yy.com/mobile/css/main.css">
    <link rel="stylesheet" href="http://re.tvbar.yy.com/mobile/css/style.css">
    <title>剧吧-帖子详情</title>
<body style="padding-bottom:60px;">
    <header id="header">
        <div class="goback-btn"></div>
        <div class="title">28条回复</div>
        <div class="right-icon-user"></div>
    </header><!-- /header -->
    <section id="post-details">
        <div class="prom-ctn">
            <div class="pormer">
                <div class="pic"><img src="http://ued.yypm.com/50x50"></div>
                <div class="p-time">
                    <h6>天生丽人</h6>
                    <p>01月12日 08:45</p>
                </div>
            </div>
            <div class="p-info">
                <h3>1部里面真真恶心的能力越大，责任也就越大</h3>
                <p>喜欢SPIDER-MAN就是因为他是个做着英雄事迹的平凡小年青,不过电影里似乎着墨更多的是打斗,而其实1的打斗感觉也一般.总体来说人物刻画不如自己的期待.......</p>
                <p><img src="http://ued.yypm.com/600x400" /></p>
                <div>
                    <a href="#">#托比·马奎尔#</a>
                    <a href="#">#克尔斯滕·邓斯特#</a>
                </div>
            </div>
        </div>
        <div class="tab-nav">
            <ul>
                <li class="active" data-id="1"><a href="javascript:void(0)">按票数最多</a></li>
                <li data-id="2"><a href="javascript:void(0)">按发布时间</a></li>
            </ul>
        </div>
        <div id="contenttog">
            <div class="p-content">
                <div class="reply-first">
                    <div class="pormer">
                        <div class="pic"><img src="http://ued.yypm.com/50x50"></div>
                        <div class="p-time">
                            <h6>天生丽人<span>回复了话题</span></h6>
                            <p>01月12日 08:45</p>
                        </div>
                        <div class="assent">
                            <a class="btn-ass" href="#"><span class="icon-thu-up"></span><b>445</b></a>
                            <a class="btn-opp" href="#" ><span class="icon-thu-dw"></span><b>5</b></a>
                        </div>
                    </div>
                    <div class="p-point">
                        <a href=""><span class="label-point">观点</span>二千有少女心，并在剧的前面就有交二千有少女心，并在剧的前面就有交</a>
                        <div class="p-pics">
                            <div>
                                <img src="http://ued.yypm.com/186x186" />
                                <img src="http://ued.yypm.com/186x186" />
                                <img src="http://ued.yypm.com/186x186" />
                            </div>
                        </div>
                    </div>
                    
                </div>
                <div class="reply-fol">
                    <div class="reply-arrow"></div><!-- 向上箭头 -->
                    <div class="pormer">
                        <div class="pic"><img src="http://ued.yypm.com/50x50"></div>
                        <div class="p-time">
                            <h6>天生丽人<span>补充证据</span></h6>
                            <p>01月12日 08:45</p>
                        </div>
                        <div class="assent">
                            <a class="btn-ass" href="#"><span class="icon-thu-up"></span><b>445</b></a>
                            <a class="btn-opp" href="#"><span class="icon-thu-dw"></span><b>5</b></a>
                        </div>
                    </div>
                    <div class="p-point">
                        <p>二千有少女心，并在剧的前面就有交二千有少女心，并在剧的前面就有交</p>
                        <div class="p-pics">
                            <div>
                                <img src="http://ued.yypm.com/186x186" />
                                <img src="http://ued.yypm.com/186x186" />
                                <img src="http://ued.yypm.com/186x186" />
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 回复内容 -->
            </div>
            <!--  -->
            <div class="p-content">
                <div class="reply-first">
                    <div class="pormer">
                        <div class="pic"><img src="http://ued.yypm.com/50x50"></div>
                        <div class="p-time">
                            <h6>天生丽人<span>回复了话题</span></h6>
                            <p>01月12日 08:45</p>
                        </div>
                        <div class="assent">
                            <a class="btn-ass" href="#"><span class="icon-thu-up"></span><b>445</b></a>
                            <a class="btn-opp" href="#"><span class="icon-thu-dw"></span><b>5</b></a>
                        </div>
                    </div>
                    <div class="p-point">
                        <a href="#"><span class="label-point">观点</span>二千有少女心，并在剧的前面就有交二千有少女心，并在剧的前面就有交</a>
                        <div class="p-pics">
                            <div>
                                <img src="http://ued.yypm.com/186x186" />
                                <img src="http://ued.yypm.com/186x186" />
                                <img src="http://ued.yypm.com/186x186" />
                            </div>
                        </div>
                    </div>
                    
                </div>
                <div class="reply-fol">
                    <div class="reply-arrow"></div><!-- 向上箭头 -->
                    <div class="pormer">
                        <div class="pic"><img src="http://ued.yypm.com/50x50"></div>
                        <div class="p-time">
                            <h6>天生丽人<span>补充证据</span></h6>
                            <p>01月12日 08:45</p>
                        </div>
                        <div class="assent">
                            <a class="btn-ass" href="#"><span class="icon-thu-up"></span><b>445</b></a>
                            <a class="btn-opp" href="#"><span class="icon-thu-dw"></span><b>5</b></a>
                        </div>
                    </div>
                    <div class="p-point">
                        <p>二千有少女心，并在剧的前面就有交二千有少女心，并在剧的前面就有交</p>
                        <div class="p-pics">
                            <div>
                                <img src="http://ued.yypm.com/186x186" />
                                <img src="http://ued.yypm.com/186x186" />
                                <img src="http://ued.yypm.com/186x186" />
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 回复内容 -->
            </div>
            <!--  -->
        </div>
        <div class="btoolbar"><a href="">添加回复</a></div>
    </section>
    <div class="load"></div>
    <div class="laodError" style="text-align:center;font-size:1.2rem;height:25px;line-height:25px;display:none;">网络加载失败，请检查网络！</div>
    <!-- 弹出框 -->
    <div class="pop" style="display:none;">
        <div class="content"></div>
        <div class="mask"></div>
    </div>
</body>
<script type="text/javascript" src="../js/zepto.min.js"></script>
<script type="text/javascript">
var moreReply = true;
var _html,_url,currTab;
$(function(){
    currTab = $(".tab-nav").find("li.active").attr("data-id");
    if(currTab == 1){
            _url = "/static/postDetails.json";
        }else if(currTab == 2){
            _url = "/static/timeDetails.json";
        }
    $(".tab-nav li").click(function(){
        currTab = $(this).attr("data-id");
        $(this).siblings().removeClass("active");
        $(this).addClass("active");
        if(currTab == 1){
            _url = "/static/postDetails.json";
            $("#contenttog").empty();
            $(".load").show();
            loadReply(currTab);
        }else if(currTab == 2){
            _url = "/static/timeDetails.json";
            $("#contenttog").empty();
            $(".load").show();
            loadReply(currTab);
        }
    })
});
function loadReply(k){
    $.ajax({
        type : "get",
        url : _url,
        dataType : "json",
        timeout: 10000,
        success : function(json){
            $(".load").hide();
            var data = json.data;
            if(!data.isEnd){
                var dataLen = data.viewPoints.length;
                var iconView = '';
                var replyClass = '';
                var replyTxt ="";
                var replyWrap = '';
                for(var i = 0; i < dataLen; i++){
                    if( data.viewPoints[i].creatorId == data.viewPoints[i].userId || !(k == undefined)){
                        replyWrap = '<div class="p-content">'
                        replyClass = "reply-first";
                        iconView = '<span class="label-point">观点</span>';
                        replyTxt = "回复了话题";
                    }else{
                        replyWrap='';
                        iconView = '';
                        replyClass= "reply-fol";
                        replyTxt = "补充证据";
                    }
                    var picLen  = data.viewPoints[i].evidences.length;
                    _html = replyWrap + '<div class="' + replyClass + '"><div class="reply-arrow"></div><div class="pormer"><div class="pic"><img src="'+ data.viewPoints[i].viewPic +'"></div><div class="p-time"><h6>'+data.viewPoints[i].creatorName +'<span>' + replyTxt + '</span></h6><p> ' + data.viewPoints[i].createTime + '</p></div><div class="assent"><a class="btn-ass" href="#"><span class="icon-thu-up"></span><b>'+data.viewPoints[i].zanCount +'</b></a><a class="btn-opp" href="#"><span class="icon-thu-dw"></span><b> '+data.viewPoints[i].opposeCount +'</b></a></div></div><div class="p-point"><a href="#">' + iconView + data.viewPoints[i].description + '</a><div class="p-pics"><div>';
                    for( var j = 0; j< picLen; j++){
                         _html += '<img src =" ' + data.viewPoints[i].evidences[j].handlePic + '" />';
                    } 
                    if( data.viewPoints[i].creatorId == data.viewPoints[i].userId || !(k == undefined)){
                        _html += "</div></div></div>";
                        $("#contenttog").append(_html);
                    }else{
                         _html += "</div></div>"
                        $(".p-content").last().append(_html);
                    }
                }
            }
        },
        error:function(){
            $(".load").hide();
            $(".laodError").show();
        }
    });
}
$(window).bind("scroll", function() {
    var top = $(document.body).scrollTop();
    var bh = $(document.body).height();
    var dh = $(document).height();
    var wh = $(window).height();
    var halfWh = wh/2;
    if (top + wh + 52 > (dh-halfWh) && moreReply) {
        loadReply();
        $(".load").show();
    }
});
    $(".btn-ass").live('tap',function(e){
        $(".content").html('<span class="pop-close"></span><h6>赞同<span class="addAssen">+1</span></h6><p>亮出你的观点，获取剧迷的认同</p><a href="#">添加证据</a>');
        $(".pop").show();
    })
    $(".btn-opp").live('tap',function(e){
        $(".content").html('<span class="pop-close"></span><h6>反对<span class="addOpp">+1</span></h6><p>亮出你的观点，获取剧迷的认同</p><a href="#">添加回复</a>');
        $(".pop").show();
        event.stopPropagation(); 
    })
    $(".pop-close").live('tap',function(){
        $(".content").empty();
        $(".pop").hide();
    })
    $(".reply-fol").live("tap",function(e){
        var btnAss = $(e.target).parent("a").hasClass("btn-ass") || $(e.target).hasClass("btn-ass");
        var btnOpp = $(e.target).parent("a").hasClass("btn-opp") || $(e.target).hasClass("btn-opp");
        if(!(btnAss || btnOpp)){
            alert("test");
        }
    });

</script>
</html>