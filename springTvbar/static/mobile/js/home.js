requirejs(["1931edition2/common"],function(i){var e=true;var f;var b;var c=navigator.userAgent,d=c.match(/iPhone|iPad|iPod/i)&&c.indexOf("AppleWebKit")>-1;var h=function(k){if(k){gotoLogin()}else{i.udblogin()}};var a=function(l,k){i.checkUserLoginCallback(function(m){if(m){i.getUserToken(function(n){if(n&&n.length>0){f=n;l(true,n)}else{if(k){h(true)}}})}else{l(false)}},function(m){if(k){h(m)}})};var g={PROJECT_REACH_FIRST_ACT:4,PROJECT_REACH_SECOND_ACT:5,PROJECT_SECOND_SUCCESS:6,PROJECT_FAILURE:7,PROJECT_AUDITING_FAILURE:8,audio:document.getElementById("audio"),audioStatus:0,isVoting:function(){var k=this;return true},init:function(){var k=this;k.getTotalInfo();k.initFanRank();k.initWeiboIframe();k.initSong();k.bindEven();k.initSubscribe()},getTotalInfo:function(){var k=this;$.ajax({url:"/agency/getUserRelateInfo.action",data:{projectId:projectId,anchorUid:anchorUid,chId:chId,subChid:subChid},dataType:"json",success:function(l){isLiving=l.data.isLiving;fansCount=l.data.fansCount;voteFansCount=l.data.voteFansCount;totalVotes=l.data.totalVotes;curGiftNum=l.data.curGiftNum;k.initTotalInfo(fansCount,voteFansCount,totalVotes,curGiftNum);j.init()}})},initTotalInfo:function(l,m,k,n){this.initTop();$("#fansCount").text(l);$("#voteFansCount").text(m);$("#anchorTotalTickets").text(k);$("#curGiftNum").text(n)},bindEven:function(){var k=this;$(".share-btn").on("click",function(){$.ajax({url:"/agency/getWeiboShareUrl.action",data:{projectId:projectId,uid:b},dataType:"json",success:function(l){if(!l||!l.data){return}var m=anchorNick+"首支单曲 进入"+l.data+"  "+shareContent;var n={title:shareTitle,content:m,shareUrl:l.data,imageUrl:shareImageurl};YYApiCore.invokeClientMethod("ui","share",n,function(){})}});hiido_statPP(anchorUid,3);return false});$(".dingyue-con .dingyue-btn").click(function(){a(function(m,l){$.ajax({url:"/agency/subscribe.action",data:{anchorUid:anchorUid,udbTicket:l},dataType:"json",success:function(n){if(n&&n.data==1){$(".dingyue-con .dingyue-btn .status").html("已订阅");$(".dingyue-con .dingyue-btn").unbind("click");$("#fansCount").html(parseInt($("#fansCount").html())+1)}}})},true);return false});$(".bottom .song-play").click(function(){if(k.audio.getAttributeNode("src").value){if(k.audioStatus==0){k.audio.play()}else{k.audio.pause()}}});$("#audio").on("play",function(){k.audioStatus=1;k.setPlayStat();try{window.YYApiCore.invokeClientMethod("data","quitChannel",{playState:"stop"})}catch(l){}});$("#audio").on("pause",function(){k.audioStatus=0;k.setPlayStat()})},setPlayStat:function(){var k=this;if(k.audioStatus==1){$(".bottom .song-play").addClass("action")}else{$(".bottom .song-play").removeClass("action")}},initTop:function(){var k=this;if(projectStatus<k.PROJECT_REACH_FIRST_ACT){$("#part-2-time").html("未开始");$("#part-3-time").empty()}else{if(projectStatus==k.PROJECT_REACH_FIRST_ACT){$("#part-2-time").countdownUI({projectId:projectId,status:k.PROJECT_REACH_FIRST_ACT});$("#part-3-time").countdownUI({projectId:projectId,status:k.PROJECT_REACH_SECOND_ACT})}else{if(projectStatus==k.PROJECT_REACH_SECOND_ACT){$(".round-list .part-2 .time").html("已成功");$("#part-3-time").countdownUI({projectId:projectId,status:k.PROJECT_REACH_SECOND_ACT})}else{if(projectStatus==k.PROJECT_SECOND_SUCCESS){$("#part-2-time").html("已成功");$("#part-3-time").html("已成功")}else{if(projectStatus==k.PROJECT_FAILURE){$("#part-2-time").empty();$("#part-3-time").html("失败")}else{if(projectStatus==k.PROJECT_AUDITING_FAILURE){$("#part-2-time").empty();$("#part-3-time").html("审核不通过")}}}}}}k.initShare();if(isLiving==="true"){$(".live-btn").show();if(chId&&""!=chId){$(".live-btn").click(function(){if(e){_goto("yymobile://Channel/Live/"+chId+"/"+subChid)}else{if(d){location.href="https://appsto.re/cn/zYDGz.i"}}return false})}}},initSubscribe:function(){a(function(l,k){$.ajax({url:"/agency/isSubscribed.action",data:{anchorUid:anchorUid,udbTicket:k},dataType:"json",success:function(m){if(m&&m.data==1){$(".dingyue-con .dingyue-btn .status").html("已订阅");$(".dingyue-con .dingyue-btn").unbind("click")}}})},false)},initShare:function(){if(!window.WebViewJavascriptBridge){}},initFanRank:function(){var k=this;$.ajax({url:"/agency/getFansRank.action",data:{projectId:projectId,num:3},dataType:"json",success:function(m){if(!m||!m.data){return}var l=$(".fensi-con ul li div");$.each(m.data,function(o,p){if(o>2){return}var n=arrowFilter(p.nick||"");var q=p.imLogo||"http://live1.yystatic.com/live/images/index/285x215.gif";$(l[o]).find("span").html(n);$(l[o]).find("img").attr("src",q)})}})},initWeiboIframe:function(){var k=800;var l="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height="+k+"&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=0&uid="+weiboUid+"&verifier="+verifier+"&dpc=1";var m='<iframe width="100%" height="'+k+'" class="share_self"  frameborder="0" scrolling="no" src="'+l+'"></iframe>';$(m).appendTo("#weiboIframe")},initSong:function(){}};var j={init:function(){var k=this;k.initUserVoteInfo();k.initProgressBar();k.bindEven()},bindEven:function(){var k=this;if(g.isVoting()){$("#voteBtnId").click(function(){k.votePre();return false})}else{$("#voteBtnId").click(function(){alert("对不起，该偶像众筹还未开始，或者已经结束，不允许投票！");return false})}},votePre:function(){var k=this;a(function(o,m){var l="";if(o){l="/agency/vote.action"}else{l="/agency/webHomeVote.action"}var n=parseInt($("#tickets em").html());if(0>=n){$.ajax({url:"/agency/getUserVoteInfo.action",data:{projectId:projectId,udbTicket:m},dataType:"json",success:function(q){if(!q||!q.data){return}var p=q.data.tickets;if(0<p){k.vote(l,m)}else{if(e){alert("点击右上角分享可获得更多票!")}else{alert("对不起，您当前没有免费票，不能投票！")}}}})}else{k.vote(l,m)}},true)},vote:function(k,l){var m=this;$.ajax({url:k,data:{projectId:projectId,udbTicket:l,shareCode:$.url.param("shareCode")||""},dataType:"json",success:function(n){alert("投票成功");m.updateVoteInfo()},error:function(o,p,n){alert("服务器繁忙，请稍后再试.")},exception:function(n){if(3002==n.result){alert("投票错误，可能是以下原因：\n1.您的免费票不够.\n2.该众筹活动还未开始，或者已经结束.");return}m.updateVoteInfo()}})},initUserVoteInfo:function(){var k=this;a(function(m,l){$.ajax({url:"/agency/getUserVoteInfo.action",data:{projectId:projectId,udbTicket:l},dataType:"json",success:function(o){if(!o||!o.data){return}var n=o.data.tickets;$("#tickets em").html(n)}})},false)},initProgressBar:function(){var k=this;k.updateProgressBar(totalVotes)},updateProgressBar:function(n){var l=100;var k=0;try{k=parseInt(n)/(finalTargetVotes*10000)*l}catch(m){}if(k<100){l=k}$("#progress-bar-show").css("width",l+"%")},updateVoteInfo:function(){var k=this;k.initUserVoteInfo();k.updateAnchorVoteInfo()},updateAnchorVoteInfo:function(){var k=this;$.ajax({url:"/agency/getAnchorVoteInfo.action",data:{projectId:projectId},dataType:"json",success:function(m){if(!m||!m.data){return}totalVotes=m.data.totalVotes;var o=m.data.curGiftNum;var l=m.data.targetGiftNum;var n=m.data.voteFansCount;$("#anchorTotalTickets").html(totalVotes);$("#curGiftNum").html(o);$("#targetGiftNum").html(l);$(".fensi-con .title span span").html(n);k.updateProgressBar(totalVotes)}})},loginAddTicket:function(l){var m=this;var k;if(l){k="/agency/loginAddTicket.action"}else{k="/agency/webLoginAddTicket.action"}i.getUserToken(function(n){if(n&&n.length>0){$.ajax({url:k,data:{projectId:projectId,udbTicket:n},dataType:"json",success:function(o){if(!o||!o.data){return}m.initUserVoteInfo()}})}})}};$(function(){i.onUdbAuthReady(function(){});i.setLoginEventEx(function(k){g.initSubscribe();j.loginAddTicket(true);b=k.uid});i.setLogoutEventEx(function(k){b=undefined});$("#rule_colse").click(function(){$("#rule_content").css("display","none");return false});$("#rule_btn").click(function(){$("#rule_content").css("display","block");return false});i.checkUserLoginCallback(function(k){e=k;j.loginAddTicket();if(!k){$(".share-btn").hide()}},function(k){e=k;if(!k){$(".share-btn").hide()}});if($.url.param("lgnback")){j.loginAddTicket(false)}g.init()})});