KindEditor.plugin("media",function(g){var i=this,a="media",b=i.lang(a+"."),j=g.undef(i.allowMediaUpload,true),h=g.undef(i.allowFileManager,false),f=g.undef(i.formatUploadUrl,true),e=g.undef(i.extraFileUploadParams,{}),c=g.undef(i.filePostName,"imgFile"),d=g.undef(i.uploadJson,i.basePath+"php/upload_json.php");i.plugin.media={edit:function(s){var o=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+b.url+"</label>",'<input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+b.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+b.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:60px;">'+b.width+"</label>",'<input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="550" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keHeight" style="width:60px;">'+b.height+"</label>",'<input type="text" id="keHeight" class="ke-input-text ke-input-number" name="height" value="400" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keAutostart">'+b.autostart+"</label>",'<input type="checkbox" id="keAutostart" name="autostart" value="" /> ',"</div>","</div>"].join("");var q=i.createDialog({name:a,width:450,height:230,title:i.lang(a),body:o,yesBtn:{name:i.lang("yes"),click:function(y){var v=g.trim(n.val()),x=p.val(),u=r.val();if(v=="http://"||g.invalidUrl(v)){alert(i.lang("invalidUrl"));n[0].focus();return}if(!/^\d*$/.test(x)){alert(i.lang("invalidWidth"));p[0].focus();return}if(!/^\d*$/.test(u)){alert(i.lang("invalidHeight"));r[0].focus();return}var w=g.mediaImg(i.themesPath+"common/blank.gif",{src:v,type:g.mediaType(v),width:x,height:u,autostart:m[0].checked?"true":"false",loop:"true"});i.insertHtml(w).hideDialog().focus()}}}),k=q.div,n=g('[name="url"]',k),l=g('[name="viewServer"]',k),p=g('[name="width"]',k),r=g('[name="height"]',k),m=g('[name="autostart"]',k);n.val("http://");if(j){var t=g.uploadbutton({button:g(".ke-upload-button",k)[0],fieldName:c,extraParams:e,url:g.addParam(d,"dir=media"),afterUpload:function(v){q.hideLoading();if(v.error===0){var u=v.url;if(f){u=g.formatUrl(u,"absolute")}n.val(u);s(u);if(i.afterUpload){i.afterUpload.call(i,u,v,a)}alert(i.lang("uploadSuccess"))}else{alert(v.message)}},afterError:function(u){q.hideLoading();i.errorDialog(u)}});t.fileBox.change(function(u){q.showLoading(i.lang("uploadLoading"));t.submit()})}else{g(".ke-upload-button",k).hide()}if(h){l.click(function(u){i.loadPlugin("filemanager",function(){i.plugin.filemanagerDialog({viewType:"LIST",dirName:"media",clickFn:function(v,w){if(i.dialogs.length>1){g('[name="url"]',k).val(v);if(i.afterSelectFile){i.afterSelectFile.call(i,v)}i.hideDialog()}}})})})}else{l.hide()}n[0].focus();n[0].select()},"delete":function(){i.plugin.getSelectedMedia().remove();i.addBookmark()}};i.clickToolbar(a,i.plugin.media.edit)});