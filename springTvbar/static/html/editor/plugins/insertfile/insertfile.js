KindEditor.plugin("insertfile",function(h){var j=this,a="insertfile",b=h.undef(j.allowFileUpload,true),i=h.undef(j.allowFileManager,false),g=h.undef(j.formatUploadUrl,true),e=h.undef(j.uploadJson,j.basePath+"php/upload_json.php"),f=h.undef(j.extraFileUploadParams,{}),d=h.undef(j.filePostName,"imgFile"),c=j.lang(a+".");j.plugin.fileDialog=function(t){var r=h.undef(t.fileUrl,"http://"),o=h.undef(t.fileTitle,""),k=t.clickFn;var p=['<div style="padding:20px;">','<div class="ke-dialog-row">','<input type="text" id="keUrl" name="url" class="ke-input-text" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+c.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+c.viewServer+'" />',"</span>","</div>","</form>","</div>"].join("");var q=j.createDialog({name:a,width:450,title:j.lang(a),body:p,yesBtn:{name:j.lang("yes"),click:function(v){var u=h.trim(m.val()),w=titleBox.val();if(u=="http://"||h.invalidUrl(u)){alert(j.lang("invalidUrl"));m[0].focus();return}if(h.trim(w)===""){w=u}k.call(j,u,w,n)}}}),l=q.div;var m=h('[name="url"]',l),n={};viewServerBtn=h('[name="viewServer"]',l),titleBox=h('[name="title"]',l);if(b){var s=h.uploadbutton({button:h(".ke-upload-button",l)[0],fieldName:d,url:h.addParam(e,"dir=file"),extraParams:f,afterUpload:function(v){n=v;q.hideLoading();if(v.error===0){var u=v.url;if(g){u=h.formatUrl(u,"absolute")}m.val(u);if(j.afterUpload){j.afterUpload.call(j,u,v,a)}alert(j.lang("uploadSuccess"))}else{alert(v.message)}},afterError:function(u){q.hideLoading();j.errorDialog(u)}});s.fileBox.change(function(u){q.showLoading(j.lang("uploadLoading"));s.submit()})}else{h(".ke-upload-button",l).hide()}if(i){viewServerBtn.click(function(u){j.loadPlugin("filemanager",function(){j.plugin.filemanagerDialog({viewType:"LIST",dirName:"file",clickFn:function(v,w){if(j.dialogs.length>1){h('[name="url"]',l).val(v);if(j.afterSelectFile){j.afterSelectFile.call(j,v)}j.hideDialog()}}})})})}else{viewServerBtn.hide()}m.val(r);titleBox.val(o);m[0].focus();m[0].select()};j.clickToolbar(a,function(){j.plugin.fileDialog({clickFn:function(k,m){var l='<a class="ke-insertfile" href="'+k+'" data-ke-src="'+k+'" target="_blank">'+m+"</a>";j.insertHtml(l).hideDialog().focus()}})})});