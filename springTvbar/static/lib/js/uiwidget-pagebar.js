(function(a){a.uiwidget=a.uiwidget||{};a.uiwidget.PageBar=function(c,b){a.extend(this,b);this.target=c;this.init()};a.uiwidget.PageBar.prototype={preText:"上一页",nextText:"下一页",displayText:"共 {0} 页，共 {1} 条",preEl:null,nextEl:null,pageNoEl:null,limitPageCount:10,hideLastPage:false,init:function(b){var c=this;if(c.limitPageCount<5){c.limitPageCount=5}if(b){a.extend(this,b)}if(!c.url&&c.totalCount){c.render({totalCount:c.totalCount});c.changePage(c);return}c.params.pageNo=c.pageNo;c.params.pageSize=c.pageSize;a.ajax({url:c.url,type:c.type||"post",dataType:"json",data:c.params,success:function(d){c.render(d);c.changePage(c)}})},render:function(j){var h=this;var d=h.totalCount=j.totalCount;if(j.totalCount<=0){h.target.empty();return}var c=h.pageSize;var b=h.pageNo;var e=parseInt(d/c);if(d%c!=0){e++}h.pageCount=e;if(e<=1){h.target.hide();return}var g='<ul class="page-bar"><li><a class="page-bar-pre" href="javascript:void(0);">'+h.preText+"</a></li>";for(var f=1;f<=e;f++){g+='<li><a id="pageBar_'+f+'" class="page-bar-no"  href="javascript:void(0);">'+f+"</a></li>"}g+='  <li><a class="page-bar-next" href="javascript:void(0);">'+h.nextText+"</a></li></ul>";a(h.target).html(g);h.target.show();h.preEl=null;h.nextEl=null;h.pageNoEl=null;h.getPreEl().click(function(){if(h.pageNo>1){h.pageNo--;h.getCurrentEl().attr("class","page-bar-no");a("#pageBar_"+h.pageNo).attr("class","page-bar-current");h.handleLimitPageCount();h.changePage(h)}return false});h.getNextEl().click(function(){if(h.pageNo<e){h.pageNo++;h.getCurrentEl().attr("class","page-bar-no");a("#pageBar_"+h.pageNo).attr("class","page-bar-current");h.handleLimitPageCount();h.changePage(h)}return false});h.getPageNoEl().click(function(){h.pageNo=parseInt(a(this).text());h.getCurrentEl().attr("class","page-bar-no");a("#pageBar_"+h.pageNo).attr("class","page-bar-current");h.handleLimitPageCount();h.changePage(h);return false});a("#pageBar_"+h.pageNo).attr("class","page-bar-current");h.handleLimitPageCount()},handleLimitPageCount:function(){var h=this;var f=h.pageCount;if(h.limitPageCount){var k='<li class="page-bar-omit" style="font-weight: bold;">...</li>';h.getPageNoEl().parent().show();h.target.find("li.page-bar-omit").remove();if(f>h.limitPageCount){if(h.pageNo<h.limitPageCount-1){for(var g=h.limitPageCount-1;g<f-1;g++){a(h.getPageNoEl()[g]).parent().hide()}a(h.getPageNoEl()[h.limitPageCount-1]).parent().after(k);if(h.hideLastPage){h.getPageNoEl().last().parent().hide();a(h.getPageNoEl()[h.limitPageCount-1]).parent().show()}}else{var g=1,e=f-2,l=0,b=true;var d=flagRight=false;while(l<(f-h.limitPageCount)){if(b){if(h.pageNo<(e+1)-1){a(h.getPageNoEl()[e]).parent().hide();flagRight=true;e--;l++}b=false}else{if(h.pageNo>(g+1)+1){a(h.getPageNoEl()[g]).parent().hide();d=true;g++;l++}b=true}if(!(h.pageNo<(e+1)-1)&&!(h.pageNo>(g+1)+1)){break}}if(flagRight){h.getPageNoEl().last().parent().before(k)}if(d){h.getPageNoEl().first().parent().after(k)}if(h.hideLastPage){if(h.pageNo<f-2){h.getPageNoEl().last().parent().hide();a(h.getPageNoEl()[e+1]).parent().show()}}}}}},format:function(c){var b=Array.prototype.slice.call(arguments,1);if(!c){throw"format is null"}return c.replace(/\{(\d+)\}/g,function(d,e){return b[e]})},getDisplayText:function(c,b){return this.format(this.displayText,'<span class="bold">'+c+"</span>",'<span class="bold">'+b+"</span>")},getLastPage:function(){var b=this;var c=parseInt(b.totalCount/b.pageSize);if(b.totalCount%b.pageSize!=0){c++}return c},goTo:function(b){var c=this;if(b&&a("#pageBar_"+b).length>0){c.pageNo=b;a("#pageBar_"+c.pageNo).click()}},getPreEl:function(){return this.preEl||(this.preEl=this.target.find(".page-bar-pre"))},getNextEl:function(){return this.nextEl||(this.nextEl=this.target.find(".page-bar-next"))},getPageNoEl:function(){return this.pageNoEl||(this.pageNoEl=this.target.find(".page-bar-no"))},getCurrentEl:function(){return this.target.find(".page-bar-current")}};a.fn.pageBar=function(b){return new a.uiwidget.PageBar(this,b)}})(jQuery);