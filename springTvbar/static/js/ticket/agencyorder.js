var com=com||{};com.yy=com.yy||{};com.yy.agency=com.yy.agency||{};com.yy.agency.AgencyOrder=function(){};!(function(d,c){var f;var e=false;var b;var a=false;d.prototype={init:function(){f=this;f.initEvent();f.initHaoYe()},url:{addAgencyPerson:"/agency/ticket/addAgencyPerson.action",updateAgencyPerson:"/agency/ticket/updateAgencyPerson.action",deleteAgencyPerson:"/agency/ticket/deleteAgencyPerson.action",addAddressAgencyOrder:"/agency/ticket/addAddressAgencyOrder.action",},initEvent:function(){f.id("addressActivate").live("click",function(){e=true;var g=c(this).closest("[_addressid]");var h=g.attr("_addressId");f.id("addressActivate").removeClass("on");c(this).addClass("on")});f.id("addAddress").click(function(){var g=c(this);a=true;if(g.attr("isSet")==1){f.showAddress(g)}else{var h=f.id("addressWrapper").find("[_id=addressActivate]").eq(0);if(h.size()==0){f.id("addNewAddress").click()}else{f.id("useAddress").show();if(a){f.id("useAddress").show()}}f.id("useAddress").attr("_orderid",g.attr("_orderid"));f.id("popup-box1").bPopup()}});f.id("useAddress").click(function(){var l=c(this);var g=l.attr("_orderid");var i=c(".on[_id=addressActivate]");var j=i.closest("[_addressid]");var k=j.find("td");var h=j.attr("_addressId");c.ajaxData(f.url.addAddressAgencyOrder,{personId:h,orderId:g},{success:function(m){var n=c("[_id=addAddress][_orderid="+g+"]");n.html("查看收货地址");n.attr("isSet",1);n.attr("_address",k.eq(2).find("p").html());n.attr("_zip",k.eq(3).html());n.attr("_tel",k.eq(1).html());n.attr("_name",k.eq(0).html());c(".close-btn").click();c.alert("填写收货地址成功","success")}})});f.id("showAddress").click(function(){var g=c(this);f.showAddress(g)});f.id("addressEdit").live("click",function(){e=true;var i=c(this).closest("[_addressid]");b=i.attr("_addressId");i.find("[_id=addressActivate]").click();var j=i.find("td");c("#myName").val(j.eq(0).html());c("#myTel").val(j.eq(1).html());c("#myCode").val(j.eq(3).html());var h=j.eq(2).find("p").attr("_address").split("##");c("#s_province").val(h[0]).trigger("change");c("#s_city").val(h[1]).trigger("change");c("#s_county").val(h[2]).trigger("change");c("#myAdress").val(h[3]);i.find("[_id=addressActivate]").click();f.id("addNewAddress").hide();f.id("useAddress").hide();c(".popup-box .add-box").show();var g=myAddress.validateName(c("#label-1 .error-tip"),c("#myName"));var m=myAddress.validateTel(c("#label-2 .error-tip"),c("#myTel"));var l=myAddress.validateDetail(c("#label-3 .error-tip"),c("#myAdress"),c(".province"),c(".city"),c(".county"));var k=myAddress.validateCode(c("#label-4 .error-tip"),c("#myCode"))});f.id("addressDel").live("click",function(){var g=c(this).closest("[_addressid]");var h=g.attr("_addressId");c.alert("确定删除地址?","ask",{fn:function(i,j){if(i.index==0){c.ajaxData(f.url.deleteAgencyPerson,{id:h},{success:function(k){g.remove();if(b==h){e=false}c.alert("删除地址成功","success")}})}}})})},initHaoYe:function(){c(function(){_init_area();c(".address-btn").click(function(){a=false;f.id("useAddress").hide();var g=f.id("addressWrapper").find("[_id=addressActivate]").eq(0);if(g.size()==0){f.id("addNewAddress").click()}f.id("popup-box1").bPopup()});f.id("addNewAddress").click(function(){e=false;c("#myName").val("");c("#myTel").val("");c("#myAdress").val("");c("#myCode").val("");c("#s_province").val("").trigger("change");c("#s_city").val("").trigger("change");c("#s_county").val("").trigger("change");f.id("addNewAddress").hide();f.id("useAddress").hide();c(".popup-box .add-box").show()});c(".save-btn").on("click",function(){var g=myAddress.validateName(c("#label-1 .error-tip"),c("#myName"));var k=myAddress.validateTel(c("#label-2 .error-tip"),c("#myTel"));var j=myAddress.validateDetail(c("#label-3 .error-tip"),c("#myAdress"),c(".province"),c(".city"),c(".county"));var i=myAddress.validateCode(c("#label-4 .error-tip"),c("#myCode"));if(g&&k&&j&i){var h={name:c("#myName").val(),tel:c("#myTel").val(),email:"",region:"",address:c(".province").html()+"##"+c(".city").html()+"##"+c(".county").html()+"##"+c("#myAdress").val(),zip:c("#myCode").val()};if(e){h.id=b;c.ajaxData(f.url.updateAgencyPerson,h,{success:function(m){var l=c("[_addressId="+b+"]");var n=l.find("td");n.eq(0).html(c("#myName").val());n.eq(1).html(c("#myTel").val());n.eq(2).find("p").html(h.address.replaceAll("##"," "));n.eq(3).html(c("#myCode").val());c(".canle-btn").click();l.find("[_address]").attr("_address",h.address);l.attr("_addressId",m.data);c.alert("地址编辑成功","success")}})}else{c.ajaxData(f.url.addAgencyPerson,h,{success:function(n){c(".canle-btn").click();c.alert("地址新增成功","success");var m='<tbody _addressId="'+n.data+'">        <tr>            <td _id="addressActivate">'+h.name+"</td>            <td>"+h.tel+'</td>        <td><p _address="'+h.address+'">'+h.address.replaceAll("##"," ")+"</p></td>            <td>"+h.zip+'</td>            <td><a href="javascript:void(0)" _id="addressEdit">编辑</a><a href="javascript:void(0)"  _id="addressDel">删除</a></td>        </tr>    </tbody>';var l=f.id("addressWrapper").find("colgroup");l.after(m);c("[_addressId="+n.data+"]").find("[_id=addressActivate]").click()}})}}});c(".canle-btn").click(function(){f.id("addNewAddress").show();if(a){f.id("useAddress").show()}c(".popup-box .add-box").hide()});c("#s_province").on("change",function(){var h;var g=c(this).find("option");g.each(function(j){if(g[j].selected==true){h=g[j].innerHTML}});c(".province").html(h);c("#s_city").trigger("change")}).trigger("change");c("#s_city").on("change",function(){var h;var g=c(this).find("option");g.each(function(j){if(g[j].selected==true){h=g[j].innerHTML}});c(".city").html(h);c("#s_county").trigger("change")}).trigger("change");c("#s_county").on("change",function(){var h;var g=c(this).find("option");g.each(function(j){if(g[j].selected==true){h=g[j].innerHTML}});c(".county").html(h)}).trigger("change")})},showAddress:function(g){f.id("popup-box2").bPopup();f.id("myAddressAddress").html(g.attr("_address").replaceAll("##"," "));f.id("myAddressTel").html(g.attr("_tel"));f.id("myAddressZip").html(g.attr("_zip"));f.id("myAddressName").html(g.attr("_name"))},parseInt:function(i,g){try{return parseInt(i)}catch(h){return g}},id:function(g){return c("[_id='"+g+"']")}}}(com.yy.agency.AgencyOrder,jQuery));var order=new com.yy.agency.AgencyOrder();order.init();