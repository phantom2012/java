var com=com||{};com.yy=com.yy||{};com.yy.agency=com.yy.agency||{};com.yy.agency.OrderCompanyList=function(){};(function(e,d){var a={};var c;var b;e.prototype={init:function(f){var g=this;f=f||{};g._init();g._initEditor()},_init:function(){d("[_id='close']").live("click",function(){d.uiwidget.popupHide({id:"popUpBox"})})},_initEditor:function(){KindEditor.ready(function(f){c=f.editor({uploadJson:"/agency/uploadWork.action",allowFileManager:false})});KindEditor.ready(function(f){b=f.editor({uploadJson:"/agency/uploadArbitration.action",allowFileManager:false})})},contact:function(g){var f=a[g];if(!f){d.ajaxData("/agency/queryUidContactInfo.action",{uid:g},{success:function(j){var i=j.data;var h=[];h.push("名字："+arrowFilter(i.name));h.push("电话："+arrowFilter(i.mobile));h.push("YY号："+arrowFilter(i.yy_num));var j=h.join("<br/>");a[g]=j;d.alert(j,"success")}})}else{d.alert(f,"success")}},toHandle:function(f){d.messagebox({type:"ask",msg:"确定开始服务?",fn:function(g){if(g.index==0){d.ajaxData("/agency/toHandle.action",{id:f},{success:function(h){d.alert("订单已受理,订单状态转为进行中","success",{fn:function(i){location.href="/agency/queryServiceOrderListByStaus.action?status="+h.data}})}})}}})},queryHistory:function(f){d.ajaxData("/agency/queryOrderChangeHistory.action",{id:f},{success:function(l){var k=l.data;var j=[];for(var g=0;g<k.length;g++){var h=k[g];j.push(h.record_time+" "+h.memo)}d.alert(j.join("<br/>"),"success")}})},toUploadTipBox:function(f){this.popUpBox("uploadTipBox",{id:f})},toUpload:function(g){var f=this;d.ajaxData("/agency/queryWorks.action",{id:g},{success:function(i){f.popUpBox("uploadBox",{id:g,list:i.data,order:f});var h=d("#uploadForm");h.data("serialize",h.serialize());d("span[_id='uploadComplete']").ajaxForm("uploadForm",{success:function(j){d.alert("提交成功","success",{fn:function(){location.href="/agency/queryServiceOrderListByStaus.action?status=2,5"}})},handleError:function(k,l){var j=k.attr("name");if("work_link"==j){k.closest("td").addClass("warning")}else{k.addClass("warning")}},handleOk:function(k){var j=k.attr("name");if("work_link"==j){k.closest("td").removeClass("warning")}else{k.removeClass("warning")}}});d("span[_id='uploadClose']").click(function(){var j=d("#uploadForm");if(j.serialize()!=j.data("serialize")){d.messagebox({type:"ask",msg:"确定放弃编辑的内容?",fn:function(k){if(k.index==0){d.uiwidget.popupHide({id:"popUpBox"})}}})}else{d.uiwidget.popupHide({id:"popUpBox"})}})}})},uploadFile:function(j,i){var g=d(j);var h=g.next('input[name="work_link"]');var f=h.next('input[name="work_size"]');c.loadPlugin("insertfile",function(){c.plugin.fileDialog({fileUrl:h.val(),clickFn:function(l,m,k){h.val(l);f.val(k.work_size);h.blur();c.hideDialog()}})})},deleteFile:function(i,h){var g=d(i);var f=g.closest("tr");if(h){d.messagebox({type:"ask",msg:"确定删除?",fn:function(j){if(j.index==0){f.remove();d.ajaxData("/agency/deleteWork.action",{id:h})}}})}else{f.remove()}},newFile:function(){var f=this.templateHtml("addUploadTr");d('tbody[_id="new"]').append(f)},browseWorks:function(g){var f=this;d.ajaxData("/agency/queryWorks.action",{id:g},{success:function(h){f.popUpBox("browseBox",{id:g,list:h.data,order:f})}})},downloadWorks:function(f){d.alert("todo")},arbitration:function(g){var f=this;d.ajaxData("/agency/queryArbitration.action",{id:g},{success:function(i){f.popUpBox("arbitrationBox",{id:g,list:i.data,order:f});var h=d("#arbitrationForm");h.data("serialize",h.serialize());d("a[_id='arbitrationComplete']").ajaxForm("arbitrationForm",{success:function(j){d.alert("提交成功","success",{fn:function(){location.href="/agency/queryServiceOrderListByStaus.action?status=4"}})},handleError:function(k,l){var j=k.attr("name");if("info_link"==j){k.closest("td").addClass("warning")}else{k.addClass("warning")}},handleOk:function(k){var j=k.attr("name");if("info_link"==j){k.closest("td").removeClass("warning")}else{k.removeClass("warning")}}});d("[_id='arbitrationClose']").click(function(){var j=d("#arbitrationForm");if(j.serialize()!=j.data("serialize")){d.messagebox({type:"ask",msg:"确定放弃编辑的内容?",fn:function(k){if(k.index==0){d.uiwidget.popupHide({id:"popUpBox"})}}})}else{d.uiwidget.popupHide({id:"popUpBox"})}})}})},newArbitrationFile:function(){var f=this.templateHtml("addArbitrationTr");d('tbody[_id="new"]').append(f)},deleteArbitrationFile:function(i,h){var g=d(i);var f=g.closest("tr");if(h){d.messagebox({type:"ask",msg:"确定删除?",fn:function(j){if(j.index==0){f.remove();d.ajaxData("/agency/deleteArbitration.action",{id:h})}}})}else{f.remove()}},tab:function(f){d("[_id='tab"+f+"']").addClass("active");d("[_id='tab"+(1-f)+"']").removeClass("active");d("[_id='show"+f+"']").show();d("[_id='show"+(1-f)+"']").hide();d("[_id='add"+f+"']").show();d("[_id='add"+(1-f)+"']").hide()},uploadArbitrationFile:function(i,h){var f=d(i);var g=f.next('input[name="info_link"]');b.loadPlugin("insertfile",function(){b.plugin.fileDialog({fileUrl:g.val(),clickFn:function(j,k){g.val(j);g.blur();b.hideDialog()}})})},arbitrationResult:function(g){var f=this;d.ajaxData("/agency/queryArbitrationResult.action",{id:g},{success:function(h){f.popUpBox("arbitrationResultBox",{id:g,list:h.data.list,record:h.data.record,order:f})}})},popUpBox:function(f,h){var g=this.templateHtml(f,h);d("#popUpBox").html(g);d.uiwidget.popupShow({id:"popUpBox"})},templateHtml:function(f,i){var h=i||{};h.$=d;h.window=window;h.document=document;var g=template(f,h);return g}}})(com.yy.agency.OrderCompanyList,jQuery);