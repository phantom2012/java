var com=com||{};com.yy=com.yy||{};com.yy.agency=com.yy.agency||{};com.yy.agency.OrderComment=function(){this.order;this.AGENCY_TYPE=0;this.IDOL_TYPE=1;this.orderInfo};!(function(b,a){var c;b.prototype={init:function(){c=this;a(".basicComment1").jRating({bigStarsPath:"http://res1.idol.yystatic.com/agency/images/jRating/stars.png",smallStarsPath:"http://res1.idol.yystatic.com/agency/images/jRating/small.png",rateMax:5,step:true,isDisabled:true})},popUpCommentDialog:function(f){this.order.popUpBox("comment_template",{item:f});var e={bigStarsPath:"http://res1.idol.yystatic.com/agency/images/jRating/stars.png",smallStarsPath:"http://res1.idol.yystatic.com/agency/images/jRating/small.png",canRateAgain:true,nbRates:100,rateMax:5,step:true,sendRequest:false,isDisabled:f.isDisabled,onClick:this.setGrade};var d=a(".basicComment").jRating(e)},appendComment:function(e,d,i,j,g,h,f){a.ajax({url:post_url+"appendComment.action",type:"post",autoAlert:true,data:{orderType:e,orderId:d,graded:i,star_comment:j,add_comment:g,agency_comment:h,agency_add_comment:f},dataType:"json",success:function(k){a.uiwidget.popupHide({id:"popUpBox"})}})},appendAgencyComment:function(){if(this.orderInfo.graded!=""){var d=a.trim(a("#commentText").val());if(!this.orderInfo.isTextDisabled){if(d==""){a.alert("请先填写评论！")}else{if(this.orderInfo.agency_comment==""){this.appendComment(this.AGENCY_TYPE,this.orderInfo.order_id,"","","",d,"")}else{if(this.orderInfo.agency_add_comment==""){this.appendComment(this.AGENCY_TYPE,this.orderInfo.order_id,"","","","",d)}}}}else{a.uiwidget.popupHide({id:"popUpBox"})}}},appendIdolComment:function(){if(this.orderInfo.graded!=""){var d=a.trim(a("#commentText").val());if(!this.orderInfo.isTextDisabled){if(d==""){a.alert("请填写评论！")}else{if(this.orderInfo.star_comment==""){this.appendComment(this.IDOL_TYPE,this.orderInfo.order_id,"",d,"","","")}else{if(this.orderInfo.add_comment==""){this.appendComment(this.IDOL_TYPE,this.orderInfo.order_id,"","",d,"","")}}}}else{a.uiwidget.popupHide({id:"popUpBox"})}}else{a.alert("请评分！")}},getComment:function(e,d){a.ajax({url:post_url+"queryOrderComment.action",type:"post",autoAlert:true,data:{orderId:d},dataType:"json",success:function(f){if(f.result==0){var g=f.data;c.orderInfo=g;g.isDisabled=false;g.isTextDisabled=true;g.buttonText="提交";if(g.graded==""){g.graded=0}if(e==c.IDOL_TYPE){if(g.graded!=""){g.isDisabled=true}if(g.star_comment==""||(g.star_comment!=""&&g.agency_comment!=""&&g.add_comment=="")){g.isTextDisabled=false}else{g.buttonText="确定"}c.popUpCommentDialog(g)}else{if(e==c.AGENCY_TYPE){g.isDisabled=true;if(g.graded==""&&g.star_comment==""){a.alert("对方未有评论！");return}if(g.agency_comment==""||(g.agency_comment!=""&&g.star_comment!=""&&g.add_comment!=""&&g.agency_add_comment=="")){g.isTextDisabled=false}else{g.buttonText="确定"}c.popUpCommentDialog(g)}}}else{a.alert("出现未知程序异常！")}}})},getAgencyComment:function(d){this.getComment(this.AGENCY_TYPE,d)},getIdolComment:function(d){this.getComment(this.IDOL_TYPE,d)},setGrade:function(d,e){a.ajax({url:post_url+"appendComment.action",type:"post",autoAlert:true,data:{orderType:c.IDOL_TYPE,orderId:a(d).attr("data-id"),graded:e,star_comment:"",add_comment:"",agency_comment:"",agency_add_comment:""},dataType:"json",success:function(f){c.orderInfo.graded=e}})}}}(com.yy.agency.OrderComment,jQuery));