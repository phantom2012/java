var com=com||{};com.yy=com.yy||{};com.yy.agency=com.yy.agency||{};com.yy.agency.CompanyInfo=function(){};(function(b,a){b.prototype={init:function(c){var d=this;c=c||{};d._initEditor(c.pics||[]);d.bindEven(c.service_city,c.business_range,c.type||0,c.sex||0);d.bindForm()},_initEditor:function(c){KindEditor.ready(function(d){var g=d.editor({allowFileManager:true,uploadJson:"/agency/admin/adminUploadLogo.action",fileManagerJson:"/agency/admin/adminUploadLogo.action"});d("#logoSource").click(function(){g.loadPlugin("image",function(){g.plugin.imageDialog({showRemote:false,clickFn:function(j,l,k,h,i,m){d("#log_pic").val(j);a("#log_pic").blur();g.hideDialog();a("#logoSource").attr("src",j);a.alert("图片上传成功","success")}})})});var f=d.editor({uploadJson:"/agency/admin/adminUploadAlbum.action",imageUploadLimit:5});d("#uploadAlbum").click(function(){f.loadPlugin("multiimage",function(){f.plugin.multiImageDialog({initImgUrls:c,removeFn:function(h,k){if(!k||k.error!=0){return}var j="/agency/admin/adminDeleteCompanyPicture.action";var i=k;a.ajaxData(j,i,{success:function(l){if(a.reg.number(l.data)){alert("由于删除了封面,默认设置图片序号为["+l.data+"]为封面")}}});a("#albums input[value='"+h+"']").remove()},imgClickFn:function(h,k){if(!k||k.error!=0){alert("请选择已经上传的图片设置封面");return}if(!a("#companyId").val()){a("#banner_pic_url").val(h);return}var j="/agency/admin/adminAlbumCover.action";var i=k;a.ajaxData(j,i,{success:function(l){alert("设置封面成功");a("#banner_pic_id").val(l.data)}})},clickFn:function(h){var i=d("#albums");i.html("");c.length=0;d.each(h,function(j,k){i.append('<input type="hidden" name="imgs" value="'+k.url+'">');c.push(k)});f.hideDialog()}})})});var e=d.editor({allowFileManager:true,uploadJson:"/agency/admin/adminUploadIndexPic.action"});d("#indexPicSource").click(function(){e.loadPlugin("image",function(){e.plugin.imageDialog({showRemote:false,clickFn:function(j,l,k,h,i,m){d("#index_pic").val(j);a("#index_pic").blur();e.hideDialog();a("#indexPicSource").attr("src",j);a.alert("图片上传成功","success")}})})})})},bindEven:function(c,g,f,h){var j=this;a("#serviceCity").agencySelect({maxLimit:5,initCodes:c,name:"service_city"});a("#businessRange").agencySelect({type:"business",splits:["A-N","O-Z"],maxLimit:5,initCodes:g,name:"business_range"});a(".name-input a.delete").live("click",function(){a(this).parent().remove()});a("#add").click(function(){a(".name-input").append('<span class="input-item"><input type="text" name="contractors" value="" placeholder="" class="input-box"><a href="javascript:void(0)" class="delete">删除</a></span>')});var e=2-a(".name-input span").size();for(var d=0;d<e;d++){a("#add").click()}a("#company").click(function(){a("#type").val(0);a("#person").removeClass("active");a("#company").addClass("active");a("#headerPic").html("公司logo");a("#log_pic").attr("msg","公司logo不能为空");a("#nameTxt").html("公司名称");a("#sex").hide();a("#build_time").show();a("#build_time input").attr("check","notBlank");a("#companyTxt").html("公司简介")});a("#person").click(function(){a("#type").val(1);a("#company").removeClass("active");a("#person").addClass("active");a("#headerPic").html("个人头像");a("#log_pic").attr("msg","个人头像不能为空");a("#nameTxt").html("姓名");a("#sex").show();a("#build_time").hide();a("#build_time input").removeAttr("check");a("#companyTxt").html("个人简介")});if(f==0){a("#company").click()}else{a("#person").click()}a("#description").blur(function(){var i=a(this);j.descriptionRemain(i)}).keyup(function(){var i=a(this);j.descriptionRemain(i)}).keydown(function(){var i=a(this);j.descriptionRemain(i)});a("#description").keyup();a("select[name='sex']").val(h)},descriptionRemain:function(h){var f="还可输入<span>";var e="已超出<span>";var c="</span>/200字";var d=200-a.chineseLength(h.val());var g;if(d>=0){g=f+d+c}else{g=e+(0-d)+c}a("#descriptionRemain").html(g)},bindForm:function(){a("#logoSubmit").click(function(){if(a("logoSource").val()){a("logoForm").submit()}else{alert("请选择上传的logo图片")}});var c=a("#submit").attr("_confirm")==1;if(c){a("#submit0").click(function(){a.alert("是否确定保存并正式发布信息？","ask",{fn:function(d){if(d.index==0){a("#submit").click()}}})})}a("#submit").ajaxForm("infoForm",{success:function(e){var d=a("#nextView").attr("link");if(!d){d=a("#nextView").attr("href")}if(c){location.reload()}else{location.href=d}},handleError:function(d,e){d.addClass("warning");d.next("span.error").remove();d.after('<span class="error">'+e+"</span>")},handleOk:function(d){d.removeClass("warning");d.next("span.error").remove()}})}}})(com.yy.agency.CompanyInfo,jQuery);