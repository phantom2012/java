var com=com||{};com.yy=com.yy||{};com.yy.ent=com.yy.ent||{};com.yy.ent.Share=function(){this.shareImgUrl="";this.tryTimes=0;this.MAXTRYTIMES=16;this.weiboParam={};this.weixinParam={}};!function(b,a){var c;b.prototype={init:function(d,e){c=this;this.initWeiboParam(e);this.initWeixinParam(d);this.getWeixinImg()},initWeiboParam:function(d){this.weiboParam.title=d.title||document.title;this.weiboParam.url=d.title||location.href;this.weiboParam.pic=d.pic||a('link[rel="icon"]').attr("href");if(d&&d.bnt){a("#"+d.bnt).on("click",function(){c.shareToWeibo(c.weiboParam)})}},shareToWeibo:function(d){window.open("http://service.weibo.com/share/share.php?title="+encodeURIComponent(d.title)+"&url="+encodeURIComponent(d.url)+"&pic="+encodeURIComponent(d.pic)+"&source=bookmark&appkey=2992571369&ralateUid=")},initWeixinParam:function(d){this.weixinParam.post_url=d.post_url||"http://idol.yy.com/agency/share/getCommonQRCodeUrl.action";this.weixinParam.req_param=d.req_param||"";this.weixinParam.gen_url_key=d.gen_url_key||"";this.weixinParam.bnt=d.bnt||"shareToWeixin";this.weixinParam.code_block=d.code_block||".codeof2d";this.weixinParam.base_url=d.base_url||"http://idol.bs2dl.yy.com/";this.weixinParam.filename=d.filename||"";this.weixinParam.shareUrl=d.shareUrl||""},generateWeixinShareImg:function(){a.ajax({url:c.weixinParam.post_url,type:"get",data:{req:c.weixinParam.req_param,key:c.weixinParam.gen_url_key,fileName:c.weixinParam.filename,shareUrl:c.weixinParam.shareUrl},dataType:"json",success:function(d){if(d.result==0){a(c.weixinParam.code_block+" img").attr("src",d.data+"?fileinformation="+new Date().getTime())}}})},getShareImgUrl:function(){return c.weixinParam.base_url+c.weixinParam.filename+".png"},getWeixinImg:function(){a("#"+c.weixinParam.bnt).mouseenter(function(){a(c.weixinParam.code_block).show()});a("#"+c.weixinParam.bnt).mouseleave(function(){a(c.weixinParam.code_block).hide()});a(c.weixinParam.code_block+" img").attr("src",c.getShareImgUrl());a(c.weixinParam.code_block+" img").off("error").on("error",function(){if(c.tryTimes==(c.MAXTRYTIMES-1)){a(c.weixinParam.code_block+" img").attr("src",c.getShareImgUrl())}else{if(c.tryTimes<c.MAXTRYTIMES){c.generateWeixinShareImg()}else{a(c.weixinParam.code_block+" img").off("error");location.reload()}}c.tryTimes++})}}}(com.yy.ent.Share,jQuery);