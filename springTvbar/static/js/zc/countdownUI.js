(function(a){a.zc=a.zc||{};a.zc.countdownUI=function(c,b){this.target=c;a.extend(this,b);this.init()};a.zc.countdownUI.prototype={projectId:0,status:-1,taskMap:{},countDownInterval:null,init:function(){var b=this;b.getAllTasks()},getAllTasks:function(){var b=this;a.ajax({url:"/agency/getAllTasks.action",type:"get",data:{projectId:b.projectId},dataType:"json",success:function(f,c,g){var e=f.data.taskList;a.each(e,function(h,j){var k=j.actId;b.taskMap[k]=j});if(b.status==4||b.status==5){var d=b.getServerNowDate(g.getResponseHeader("Date"));b.initCountDownTime(d)}},exception:function(c){}})},getServerNowDate:function(d){var b=null;try{if(!d){b=new Date()}else{b=new Date(formatDate(d,"yyyy/MM/dd hh:mm:ss"))}}catch(c){if(b==null){b=new Date()}return b}return b},initCountDownTime:function(j){var g=this;if(g.countDownInterval){clearInterval(g.countDownInterval);g.countDownInterval=null}if(!j){j=g.getServerNowDate(null)}var f=g.getDownTimeEndDate().getTime();if(f==null||f==""){return false}var i=j.getTime();var d=Math.ceil((f-i)/1000);if(d>6*24*3600){return false}if(d<0){d=0}var b=Math.floor(d/(60*60));var c=b*60*60;var e=Math.floor((d-c)/60);var h=d-c-e*60;g.showCountDownTime(b,e,h);var k={h:b,m:e,s:h};g.countDownInterval=setInterval(function(){g.countDownTime(k);g.showCountDownTime(k.h,k.m,k.s);if(k.h==0&&k.m==0&&k.s==0){clearInterval(g.countDownInterval);g.countDownInterval=null}},1000)},showCountDownTime:function(b,d,c){var e=this;if(b>24){e.target.text("还剩"+Math.ceil(b/24)+"天")}else{if(10>parseInt(b)){b="0"+b}if(10>parseInt(d)){d="0"+d}if(10>parseInt(c)){c="0"+c}e.target.text("还剩"+b+":"+d+":"+c);if(0>=b&&0>=d&&0>=c){if(e.renderTimeOver){e.renderTimeOver()}}}},getDownTimeEndDate:function(){var c=this;var b=null;if(c.status==4||c.status==5){if(c.status==4){b=c.taskMap[1]}else{if(c.status==5){b=c.taskMap[2]}}}if(b!=null&&b!=""){if(b.endTime.length>2){return new Date(formatDate(b.endTime.substring(0,b.endTime.length-2),"yyyy/MM/dd hh:mm:ss"))}else{return null}}},countDownTime:function(b){if(b.s==0&&(b.h>0||b.m>0)){b.s=59;if(b.m==0){b.m=59;b.h=b.h-1}else{b.m=b.m-1}}else{if(b.s>0){b.s=b.s-1}}}};a.fn.countdownUI=function(b){return new a.zc.countdownUI(this,b)}})(jQuery);