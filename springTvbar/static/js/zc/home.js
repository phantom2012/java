var homeInit={PROJECT_REACH_FIRST_ACT:4,PROJECT_REACH_SECOND_ACT:5,PROJECT_SECOND_SUCCESS:6,PROJECT_FAILURE:7,PROJECT_AUDITING_FAILURE:8,projectId:0,isShareImgExist:false,isInitShareImg:true,shareImgUrl:"",isVoting:function(){var a=this;return projectStatus==a.PROJECT_REACH_FIRST_ACT||projectStatus==a.PROJECT_REACH_SECOND_ACT},init:function(a){var b=this;b.projectId=a;b.getTotalInfo();b.initFanRank();b.initSong();b.initVideo();b.initWeiboIframe();b.bindEven()},getTotalInfo:function(){var a=this;$.ajax({url:"/agency/getUserRelateInfo.action",data:{projectId:projectId,anchorUid:anchorUid,chId:chId,subChid:subChid},dataType:"json",success:function(b){isLiving=b.data.isLiving;fansCount=b.data.fansCount;voteFansCount=b.data.voteFansCount;totalVotes=b.data.totalVotes;curGiftNum=b.data.curGiftNum;a.initTotalInfo(fansCount,voteFansCount,totalVotes,curGiftNum);voteCon.init(projectId)}})},initTotalInfo:function(b,c,a,d){this.initTop();$("#fansCount").text(b);$("#fans_star_view .right-txt p:eq(1)").text(c);$("#anchorTotalTickets").text(a);$("#curGiftNum").text(d)},bindEven:function(){var a=this;$("#noLoginBox #loginId").click(showLoginBox);$("#btn-sub-id").click(function(){if(!isLogin()){showLoginBox();return}$.ajax({url:"/agency/subscribe.action",data:{anchorUid:anchorUid},dataType:"json",success:function(b){if(b&&b.data==1){$("#btn-sub-id").addClass("btn-sub-o");$("#btn-sub-id strong").html("已订阅");$("#btn-sub-id").unbind("click");$("#fansCount").html(parseInt($("#fansCount").html())+1)}}})});a.initShare("#share-weixin-top .codeof2d img");$("#share-weixin-top").mouseenter(function(){isInitShareImg=false;a.initShare("#share-weixin-top .codeof2d img")});$("#share-weixin-bottom").mouseenter(function(){isInitShareImg=false;a.initShare("#share-weixin-bottom .codeof2d img")});$("#share-weixin-top .codeof2d img").unbind("error");$("#share-weixin-top .codeof2d img").error(function(){a.getQrCodeImgUrl(this)});$("#share-weixin-bottom .codeof2d img").unbind("error");$("#share-weixin-bottom .codeof2d img").error(function(){a.getQrCodeImgUrl(this)})},initTop:function(){var a=this;if(projectStatus<a.PROJECT_REACH_FIRST_ACT){$("#part-2-time").html("未开始");$("#part-3-time").empty()}else{if(projectStatus==a.PROJECT_REACH_FIRST_ACT){$("#part-2-time").countdownUI({projectId:a.projectId,status:a.PROJECT_REACH_FIRST_ACT,renderTimeOver:a.renderTimeOver1});$("#part-3-time").empty()}else{if(projectStatus==a.PROJECT_REACH_SECOND_ACT){$("#part-2-time").html("已成功");$("#part-3-time").countdownUI({projectId:a.projectId,status:a.PROJECT_REACH_SECOND_ACT,renderTimeOver:a.renderTimeOver2})}else{if(projectStatus==a.PROJECT_SECOND_SUCCESS){$("#part-2-time").html("已成功");$("#part-3-time").html("已成功")}else{if(projectStatus==a.PROJECT_FAILURE){$("#part-2-time").empty();$("#part-3-time").html("失败")}else{if(projectStatus==a.PROJECT_AUDITING_FAILURE){$("#part-2-time").empty();$("#part-3-time").html("审核不通过")}}}}}}if(isLiving&&"false"!=isLiving){$(".btn-liveing").show();if(chId&&""!=chId){$(".btn-liveing").click(function(){gotoYYClientChannel(chId,subChid,anchorYYNum)})}}if(anchorNick&&anchorNick!=""){anchorNick=arrowFilter(anchorNick);$("#voteBtnId strong:eq(0)").html("为TA投票")}if(isLogin()){showLoginInfo();if(loginCfg.isLoginCallBack){loginCfg.isLoginCallBack()}a.initSubscribe()}else{$("#loginBox").hide();$("#noLoginBox").show()}},initSubscribe:function(){if(!isLogin()){return}$.ajax({url:"/agency/isSubscribed.action",data:{anchorUid:anchorUid},dataType:"json",success:function(a){if(a&&a.data==1){$("#btn-sub-id").addClass("btn-sub-o");$("#btn-sub-id strong").html("已订阅");$("#btn-sub-id").unbind("click")}}})},initShare:function(a){var b=this;$(a).attr("src",b.getShareImgUrl())},getShareImgUrl:function(){var b=this;if(b.shareImgUrl){return b.shareImgUrl}var a="http://agency.bs2dl.yy.com/bs2qrCodeImg_"+b.projectId;if(isLogin()&&$.cookie("yyuid")){a+="_"+$.cookie("yyuid")+".png"}else{a+=".png"}b.shareImgUrl=a;return a},getQrCodeImgUrl:function(a){var b=this;if(b.isShareImgExist&&isInitShareImg){return}if(b.isShareImgExist){$(a).attr("src",b.getShareImgUrl()+"?_="+new Date().getTime());return}$.ajax({url:"/agency/getQRCodeUrl.action",data:{projectId:b.projectId,uid:anchorUid},dataType:"json",success:function(c){if(!c||!c.data){return}b.shareImgUrl=c.data;$(a).attr("src",c.data+"?_="+new Date().getTime());b.isShareImgExist=true}})},initFanRank:function(){var a=this;$.ajax({url:"/agency/getFansRank.action",data:{projectId:a.projectId,num:3},dataType:"json",success:function(c){if(!c||!c.data){return}var b=$("#fans_star_view .bd .fans-star a");$.each(c.data,function(e,f){if(e>2){return}var d=arrowFilter(f.nick||"");var g=f.imLogo||"http://live1.yystatic.com/live/images/index/285x215.gif";$(b[e]).attr("title",d);$(b[e]).find("img").attr("src",g)})}})},initWeiboIframe:function(){var e=$(".layout .layout-left .border-box").outerHeight(true);var b=$("#fans_star_view").outerHeight(true)+$(".layout .layout-right #video_view").outerHeight(true);var a=e-b-15;if(800<a){a=800}var c="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height="+a+"&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=0&uid="+weiboUid+"&verifier="+verifier+"&dpc=1";var d='<iframe width="100%" height="'+a+'" class="share_self"  frameborder="0" scrolling="no" src="'+c+'"></iframe>';$(d).appendTo("#weiboIframe")},initSong:function(){var a=this;$.ajax({url:"/agency/querySong.action",data:{projectId:a.projectId,uid:anchorUid,num:2},dataType:"json",success:function(b){if(!b||!b.data||!b.data.list||0>=b.data.list.length){$("#music_view").hide();$("#fans_star_view").removeClass("mt-10");window.music.init();return}var c=$("#music-list").empty();$.each(b.data.list,function(f,i){var e=i.name||"";var h=i.play_count||0;var d=i.save_path||"";var j=i.id||"";var g="";if(0==f){g+='<li class="first">'}else{g+="<li>"}g+="<strong>"+(f+1)+"."+e+"</strong>";g+='<span>播放次数：<i class="play-count">'+h+"</i></span>";g+='<a class="music-btn" _url="'+d+'" href="javascript:void(0);" songId="'+j+'"></a>';g+="</li>";$(g).find(".music-btn");c.append(g).find(".music-btn:eq("+f+")").click(function(){var k=$(this);if(!k.hasClass("play")){var l=$(this).prev().find("i.play-count");l.html(parseInt(l.html())+1);a.addSongPlayCount(j)}})});window.music.init()},error:function(c,d,b){window.music.init()},exception:function(b){window.music.init()}})},initVideo:function(){var a=this;$.ajax({url:"/agency/getVideos.action",data:{projectId:a.projectId,uid:anchorUid,num:3},dataType:"json",success:function(c){if(!c||!c.data){$("#video_view").hide();window.video.init();return}var b=$("#video_list").empty();$.each(c.data.list,function(g,j){var f=j.url;var i=j.clicks||0;var d=j.thumb||"";var e=j.name||"";var k=j.id||"";var h='<li><div class="video-pic">';h+='<img src="'+d+'">';h+='<a class="video-btn" href="'+f+'" target="_blank" title="'+e+'" videoId="'+k+'"></a>';h+="</div><p>播放次数：<i>"+i+"</i></p></li>";b.append(h).find(".video-btn:eq("+g+")").click(function(){var l=$(this).parent().next().find("i");l.html(parseInt(l.html())+1);a.addVideoPlayCount(k)})});window.video.init()},error:function(c,d,b){window.video.init()},exception:function(b){window.video.init()}})},addSongPlayCount:function(b){var a=this;$.ajax({url:"/agency/addSongPlayCount.action",data:{uid:anchorUid,projectId:a.projectId,songId:b},dataType:"json",success:function(c){}})},addVideoPlayCount:function(a){var b=this;$.ajax({url:"/agency/admin/addVideoPlayCount.action",data:{uid:anchorUid,projectId:b.projectId,videoId:a},dataType:"json",success:function(c){}})},renderTimeOver1:function(){$(".part-hint .part-2 p").empty()},renderTimeOver2:function(){$(".part-hint .part-3 p").empty()}};var voteCon={projectId:0,init:function(a){var b=this;b.projectId=a;b.initUserVoteInfo();b.initProgressBar();b.bindEven();b.loginAddTicket();loginCfg.loginCallBack=function(){b.loginAddTicket()}},bindEven:function(){var a=this;if(homeInit.isVoting()){$(".vote-box #voteBtnId").click(function(){a.votePre()})}else{$(".vote-box #voteBtnId").click(function(){alert("对不起，该偶像众筹还未开始，或者已经结束，不允许投票！")})}},votePre:function(){var b=this;if(!isLogin()){showLoginBox();return}var a=parseInt($("#tickets").html());if(0>=a){alert("对不起，您当前没有免费票，不能投票！")}else{b.vote()}},vote:function(){var a=this;$.ajax({url:"/agency/webHomeVote.action",data:{projectId:a.projectId,udbTicket:"",shareCode:$.url.param("shareCode")||""},dataType:"json",success:function(b){window.vote.add();a.updateVoteInfo()},error:function(c,d,b){alert("服务器繁忙，请稍后再试.")},exception:function(b){if(3002==b.result){alert("投票错误，可能是以下原因：\n1.您的免费票不够.\n2.该众筹活动还未开始，或者已经结束.");return}window.vote.add();a.updateVoteInfo()}})},initUserVoteInfo:function(){if(!isLogin()){return}var a=this;$.ajax({url:"/agency/getUserVoteInfo.action",data:{projectId:a.projectId},dataType:"json",success:function(d){if(!d||!d.data){return}var c=d.data.tickets;var b=d.data.voteTickets;$("#tickets").html(c);$("#voteTickets").html(b)}})},initProgressBar:function(){window.vote.init({max:orgFinalTargetVotes,votes:totalVotes})},updateProgressBar:function(a){if(!window.vote.param){window.vote.param=$.extend({},{max:orgFinalTargetVotes})}if(a){window.vote.param.votes=a}else{window.vote.param.votes+=1}window.vote.init(window.vote.param)},updateVoteInfo:function(){var a=this;a.updateUserVoteInfo();a.updateAnchorVoteInfo()},updateUserVoteInfo:function(){var d=this;var c=$("#tickets");var b=$("#voteTickets");var a=parseInt(c.html())-1;if(0>a){a=0}c.html(a);b.html(parseInt(b.html())+1);if(0==a&&d.needShareHint()){window.share.showShareHint()}},updateAnchorVoteInfo:function(){var a=this;$.ajax({url:"/agency/getAnchorVoteInfo.action",data:{projectId:a.projectId},dataType:"json",success:function(c){if(!c||!c.data){return}totalVotes=c.data.totalVotes;var e=c.data.curGiftNum;var b=c.data.targetGiftNum;var d=c.data.voteFansCount;$("#anchorTotalTickets").html(totalVotes);$("#curGiftNum").html(e);$("#targetGiftNum").html(b+"万");$("#fans_star_view .hd .right-txt p:eq(1)").html(d);a.updateProgressBar(totalVotes)}})},loginAddTicket:function(){if(!isLogin()){return}var a=this;$.ajax({url:"/agency/webLoginAddTicket.action",data:{projectId:a.projectId},dataType:"json",success:function(c){if(!c||!c.data){return}var d=$("#tickets");var b=parseInt(d.html())+1;d.html(b)}})},needShareHint:function(){var a="agency_yy_com_share_hint";var b=getLoginUid();if(b){a+="_"+b}return !$.cookie(a)}};